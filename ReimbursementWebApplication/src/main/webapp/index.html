<html>
<body>

<h1>Prodigy</h1>

<p>Welcome to the best to-do app on the web</p>

<h2>Task</h2>
<input id="descInput" type="text" placeholder="task">
<input id="priorityInput" type="text" placeholder="priority">
<button id="addTaskBtn"> Add Task</button>

<h2>All Tasks</h2>
<button id="allTasksBtn"> Get all Tasks</button>

<table id="taskTable">
  <tr><thead> <th> Description</th> <th> Priority </th> <th>Completed</th></thead> </tr>
  <tr >
</table>

</body>

<script>

      document.getElementById("allTasksBtn").addEventListener("click",getAllTasks)
      document.getElementById("addTaskBtn").addEventListener("click",addTask)

      async function getAllTasks(){
          let httpResponse=await fetch("http://localhost:8080/ToDoListApp/api/tasks");
          let tasks= await httpResponse.json();

          let tableData=document.getElementById("taskTable");

          for(task of tasks){
              tableData.innerHTML=tableData.innerHTML + `<tr> <td>${task.description}</td>
                <td>${task.priority}</td> <td>${task.isDone}</td> <td> <button tId=${task.tId} desc="${task.description}"  priority=${task.priority} onclick="approve(this)"> Mark Complete </td> </tr> `;
          }
          console.log(tasks);

      }

      async function addTask(){

         let task={
             tId:0,
             isDone:false

         }

         task.description=document.getElementById("descInput").value;
         task.priority=Number.parseInt(document.getElementById("priorityInput").value);

         console.log(task);

          let settings={
             method:'POST',
             headers:{'Content-Type':'application/json'},
             body:JSON.stringify(task)
         }

         let httpResponse=await fetch("http://localhost:8080/ToDoListApp/api/addtask", settings);
        
      }

      async function approve(element){
             console.log("Hello");
             console.log(element.tId);

             let tId=element.tId;

             task.tId=element.tId;
             task.description=element.desc;
             task.isDone=true;
             task.priority=element.priority;
             console.log(task);
             console.log(element);

             let settings={
             method:'POST',
             headers:{'Content-Type':'application/json'},
             body:JSON.stringify(task)
         }

         let httpResponse=await fetch("http://localhost:8080/ToDoListApp/api/updatetask", settings)
         
         console.log(httpResponse);
      }
</script>

</html>

